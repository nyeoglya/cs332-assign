## 3. Functions

- 프로그램들은 초기에는 루틴과 서브루틴을 이용하여 시스템을 구성하였다. 그런 다음, 포트란의 시대에서는 프로그램, 하위 프로그램, 함수로 구성된 시스템을 구성했다. 오늘날에는 그 초창기부터 함수만이 살아남게 되었다. 즉, 함수는 모든 프로그램의 가장 주요한 구성이다. 이 장의 내용은 이러한 함수를 잘 작성하는 법에 대해 다룬다.

### 3-1. 함수는 작아야 한다

- 함수에 대한 첫 번째 규칙은, 함수가 작아야 한다는 것이다. 함수는 화면을 채우는 것 이상으로 길어지면 안된다. 즉, 대략 100줄 이상을 넘어가는 것은 좋지 않은 일이라는 것이다.
- 이러한 규칙은 `if`, `else`, `while`과 같은 block 구문들은 거의 1줄을 넘어가면 안된다는 것을 의미한다.
- 또한, 함수는 중첩된 구조들을  포함할 정도로 너무 크면 안된다.

### 3-2. 하나의 행동을 해라

- 어떠한 함수가 하나 초과의 행동을 한다면, 이것은 굉장히 비효율적이다. 그런 것보다, 각 역할을 하는 함수를 모두 쪼개버리는 것이 좋다.

### 3-3. 함수 당 하나의 추상화 레벨

- 하나의 함수가 한 가지의 역할만 한다는 것을 공고히 하기 위해, 함수의 각 statement는 같은 수준의 추상화를 이루고 있어야 한다.
- 가령, HTML과 관련된 코드를 작성한다고 할 때, `.getHTML`같은 statement는 굉장히 고수준이다. `PathParser.render()`는 중간 정도의 수준이며, `.append()`는 굉장히 저수준이다. 이러한 여러 수준의 코드들이 한 곳에 몰려 있는 것은 좋지 않다.
- 코드는 위에서 아래로 읽힐 수 있는 구조로 작성되어야 하며, 각 함수는 다음 레벨의 추상화로 자연스럽게 이어져야 한다. 이것이 함수를 짧게 유지하고 하나의 일만 할 수 있도록 만드는데 큰 도움을 준다.

### 3-4. switch 구문을 처리하는 방법

- 짧은 `switch` 구문을 만드는 것은 어렵다. 하나의 함수보다 `case` 2개 밖에 없는 `switch` 구문이 더 길 지경이다. 그러나, `switch`를 언제나 사용하지 않을 수는 없기 때문에, 최대한의 반복을 막기 위해 polymorphism을 쓰는 것을 권장한다.
- 또한, `switch` 구문 자체를 추상 팩토리를 만들어서 감춰버리면 된다. 함수 자체는 짧게 유지하고, 그 실제 구현은 `switch`로 하는 방식이다.

### 3-5. 좋은 이름을 써라

- 함수의 이름은 함수가 뭘 하는지를 명확하게 나타내어야 한다. 필요하다면 긴 이름을 만드는 것을 망설일 필요가 없다. 반대로, 긴 이름을 만든다고 시간을 너무 많이 쓰는 것도 좋지 않다. 일단 이름을 한번 만들어보고 실험해보는 것이 좋다.

### 3-6. 매개변수는 적어야 한다

- 함수의 매개변수는 적을수록 좋다. 3개보다 많은 매개변수는 좀 지양할 필요가 있다. 매개변수는 함수 이름과는 또 다른 수준의 추상화 레벨에서 존재하며, 우리로 하여금 함수의 추가적인 세부 사항을 알도록 강제한다. 특히, 매개변수가 많으면 함수를 테스트할 때 더 어렵게 다가온다.
- output argument는 더 어렵다. 보통 함수를 만들 때, 매개변수로 값을 넣을 생각을 하지, 거기서 값이 나온다는 생각을 잘 안하기 때문이다.
- 함수에 하나의 매개변수를 넣는 이유에는 크게 2가지가 있다. 한 가지는 그 매개변수에 대한 값을 함수에 물어보는 것이고, 다른 한 가지는 그 매개변수의 값을 활용하여 동작을 수행하는 것이다. 즉, 이러한 형태를 따르지 않는 함수는 하나의 매개변수를 가지는 것 자체를 피하는 것이 좋다.
- flag argument는 좋지 않은 선택이 될 수 있다. bool 값을 함수 안에 집어넣는 것은 정말 좋지 않은 선택이 될 수 있다. 이러한 bool 값 자체는 함수가 하나 이상의 행동을 한다는 것을 의미하게 된다.
- 두 개의 매개변수를 가진 함수는 하나의 매개변수를 가진 함수보다도 더 알아보기 힘들다. 물론 이러한 함수가 나쁘다는 것은 아니지만, 이들이 가져올 비용을 생각해 적절히 선택하는 것이 중요하다.
- 세 개의 매개변수를 가진 함수는 정말로 큰 어려움이 있다. 이러한 함수를 만들기 전에 꼭 다시 생각해볼 것을 권한다.
- 만약 함수가 여러 개의 매개변수를 필요로 한다면, 그 매개변수를 묶어서 하나의 타입으로 만드는 것도 좋은 선택이다. 매개변수들이 상호 연관이 있는 경우가 있기 때문이다. 비슷하게, 매개변수 리스트를 사용해도 된다.

### 3-7. 부수 효과를 없애라

- 부수 효과는 마치 거짓말 같은 것이다. 이건 우리의 함수가 하나의 역할을 할 것이라는 약속을 해놓고, 알려지지 않은, 숨겨진 다른 작업을 해버리는 것이다. 이러한 일은 가끔 변수에 알 수 없는 조작을 가할 수도 있다.
- 이는 output argument가 자연스럽지 않은 이유와도 상통한다. 보통 매개변수는 함수의 입력 값으로 취급된다. 이때, output argument는 내가 넣은 매개변수에 수정을 가하기 때문에 일종의 부수 효과를 만들어낸다고 볼 수 있다.

### 3-8. 함수의 기능을 분리하라

- 함수는 무언가를 하거나, 답하는 역할을 한다. 그러나, 이 둘을 동시에 해서는 안된다. 이러한 중복된 활동은 헷갈리는 코드를 낳을 뿐이다.

### 3-9. 에러 코드에 예외를 추가해라

- exception 코드를 추가하는 것은 함수의 기능을 분리하는 것과 비슷한 맥락의 이야기이다.
- 에러를 바로 반환하는 것은 그리 좋지 않은데, 이는 코드를 불러낸 사람이 각종 에러를 if 문 등을 이용해 전부 처리해버려야 하기 때문이다. 즉, 이런 것 대신에 exception을 이용하여 호출하는 사람이 자신의 코드를 `try/catch` 구문으로 감싸서 `catch`에서 exception을 처리하도록 하여 훨씬 단순화시킬 수 있다.
- `try/catch` 구문은 그 자체로 별로 좋지 않다. 이들은 코드의 구조를 헷갈리게 하고, 일반적인 과정에 에러가 있는 과정을 섞어버린다. 즉, 이들을 함수의 본체에서 추출하여 이것을 다루는 함수를 따로 만드는 것이 좋다. 가령, 함수 `A`가 있다면, `tryA`라는 새로운 함수에서 `try { A() } catch {…}`와 같이 다루는 것이다. 이렇게 하면, `tryA`를 실행하여 에러도 잡고 이러한 문제도 해결할 수 있다.
- 에러를 다루는 것 또한 하나의 일이다. 즉, 에러를 다루는 함수는 다른 일을 동시에 수행하지 말아야 한다.

### 3-10. 비슷한 코드를 반복하지 마라

- 내부에 비슷한 코드가 반복되는 것은 좋지 않다. 이러한 코드는 모든 소프트웨어의 만악의 근원이다. 만약, 중복되는 코드에 문제가 발생한다면, 중복되는 지점마다 문제가 발생하게 된다. 즉, 이러한 것은 지양하고 객체지향적 관점에서 중복을 제거하는 여러 전략들을 살펴보는 것도 좋다.

### 3-11. 구조적 프로그래밍

- 어떤 프로그래머들은 다익스트라의 규칙을 따른다. 이는 모든 함수가 1개의 진입점과 출구만이 있어야 한다는 것이다. 이러한 규칙은 하나의 return문이 존재해야 한다는 것이며, `goto`나 `break`, `continue`가 loop 내에 없어야 한다는 것을 의미한다.
- 이런 규칙은 함수가 작을 때는 약간 유용하다. 이것은 큰 함수에서만 많이 유용할 뿐이다. 즉, 함수를 작게 유지하면서 출입점을 여러 개로 설정하는 것은 큰 문제가 되지 않는다. 반면에, `goto`는 쓰지 않아야 한다.
